# 高度gis综合数据平台对接文档

> 本文档描述 高度gis综合数据平台 API 对接流程

## 修改记录

| 编号 | 修改日期 | 修改内容 | 修改人 |
| -----|----------|----------|--------|
| 1    | 20220728 | 创建文档 | zpl    |

## 子系统描述

### 管理系统

管理系统管理用户、设备、权限、配置等数据，并以 **REST** 方式对外提供服务， 如：

- 用户登录鉴权
- 获取设备列表

### 无人机控制系统

无人机控制系统以 **REST** 接口方式提供 对飞行任务、机场、无人机、吊舱及其他挂载的控制，并通过 **MQTT** 协议对外发布 飞行任务、机场、无人机的实时信息。

> 在WEB 前端， 我们使用 [mqtt.js](https://github.com/mqttjs) 以 **websocket** 的方式提供 **MQTT** 的接入。

REST 接口如:

- 任务 执行
- 机场 复位
- 无人机 悬停
- 无人机 返航
- 吊舱云台控制

MQTT 消息如:

- 机场电池仓电压电量信息
- 机场气象信息
- 机场自动器械运动信息
- 无人机位置信息

#### 视频系统

系统内机场、吊舱视频使用低延时 **webrtc** 协议进行通讯，信令（如SDP, ICE Candidate）通过 **websocket** 协议交互。



## 实体定义

系统内包含以下实体：

- 节点(node)
> 节点对应一台管理服务器，节点内运行 无人机控制系统  
> 一个节点可控制多台机场、无人机。

- 机场(airport)
- 无人机(drone)



## API 对接流程简介

以获取机场无人机位置信息及查看视频为例，流程如下:

- 使用系统提供的账号，密码等信息进行登录，获取token 见 [rest.md](1.rest.md)
- 使用获取到的token 获取 机场、无人机列表、吊舱信息 
- 根据机场id、无人机id 构造topic，订阅无人机的实时信息
- 根据吊舱id 向视频系统发起连接 [video](4.video.md)

## 服务器地址信息

域名: https://drone.godouav.com
端口: 443

## 对接资料

对接需要向高度创新申请获取以下元素:

- 账号
	对接用户账号
- 密码
	对接用户密码
- AppId
	对接AppID
- Secret
	对接密钥
- PublicKey
	对接公钥
