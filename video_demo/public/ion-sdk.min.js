var IonSDK=function(g){var I={};function C(A){if(I[A])return I[A].exports;var c=I[A]={i:A,l:!1,exports:{}};return g[A].call(c.exports,c,c.exports,C),c.l=!0,c.exports}return C.m=g,C.c=I,C.d=function(g,I,A){C.o(g,I)||Object.defineProperty(g,I,{enumerable:!0,get:A})},C.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},C.t=function(g,I){if(1&I&&(g=C(g)),8&I)return g;if(4&I&&"object"==typeof g&&g&&g.__esModule)return g;var A=Object.create(null);if(C.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:g}),2&I&&"string"!=typeof g)for(var c in g)C.d(A,c,function(I){return g[I]}.bind(null,c));return A},C.n=function(g){var I=g&&g.__esModule?function(){return g.default}:function(){return g};return C.d(I,"a",I),I},C.o=function(g,I){return Object.prototype.hasOwnProperty.call(g,I)},C.p="",C(C.s=1)}([function(module,exports,__webpack_require__){"use strict";eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.makeRemote = exports.LocalStream = exports.VideoConstraints = void 0;\r\nconst resolutions = ['qvga', 'vga', 'shd', 'hd', 'fhd', 'qhd'];\r\nexports.VideoConstraints = {\r\n    qvga: {\r\n        resolution: {\r\n            width: { ideal: 320 },\r\n            height: { ideal: 180 },\r\n            frameRate: {\r\n                ideal: 15,\r\n                max: 30,\r\n            },\r\n        },\r\n        encodings: {\r\n            maxBitrate: 150000,\r\n            maxFramerate: 15.0,\r\n        },\r\n    },\r\n    vga: {\r\n        resolution: {\r\n            width: { ideal: 640 },\r\n            height: { ideal: 360 },\r\n            frameRate: {\r\n                ideal: 30,\r\n                max: 60,\r\n            },\r\n        },\r\n        encodings: {\r\n            maxBitrate: 500000,\r\n            maxFramerate: 30.0,\r\n        },\r\n    },\r\n    shd: {\r\n        resolution: {\r\n            width: { ideal: 960 },\r\n            height: { ideal: 540 },\r\n            frameRate: {\r\n                ideal: 30,\r\n                max: 60,\r\n            },\r\n        },\r\n        encodings: {\r\n            maxBitrate: 1200000,\r\n            maxFramerate: 30.0,\r\n        },\r\n    },\r\n    hd: {\r\n        resolution: {\r\n            width: { ideal: 1280 },\r\n            height: { ideal: 720 },\r\n            frameRate: {\r\n                ideal: 30,\r\n                max: 60,\r\n            },\r\n        },\r\n        encodings: {\r\n            maxBitrate: 2500000,\r\n            maxFramerate: 30.0,\r\n        },\r\n    },\r\n    fhd: {\r\n        resolution: {\r\n            width: { ideal: 1920 },\r\n            height: { ideal: 1080 },\r\n            frameRate: {\r\n                ideal: 30,\r\n                max: 60,\r\n            },\r\n        },\r\n        encodings: {\r\n            maxBitrate: 4000000,\r\n            maxFramerate: 30.0,\r\n        },\r\n    },\r\n    qhd: {\r\n        resolution: {\r\n            width: { ideal: 2560 },\r\n            height: { ideal: 1440 },\r\n            frameRate: {\r\n                ideal: 30,\r\n                max: 60,\r\n            },\r\n        },\r\n        encodings: {\r\n            maxBitrate: 8000000,\r\n            maxFramerate: 30.0,\r\n        },\r\n    },\r\n};\r\nconst defaults = {\r\n    resolution: 'hd',\r\n    codec: 'vp8',\r\n    audio: true,\r\n    video: true,\r\n    simulcast: false,\r\n};\r\nclass LocalStream extends MediaStream {\r\n    constructor(stream, constraints) {\r\n        super(stream);\r\n        this.constraints = constraints;\r\n    }\r\n    static async getUserMedia(constraints = defaults) {\r\n        const stream = await navigator.mediaDevices.getUserMedia({\r\n            audio: LocalStream.computeAudioConstraints({\r\n                ...defaults,\r\n                ...constraints,\r\n            }),\r\n            video: LocalStream.computeVideoConstraints({\r\n                ...defaults,\r\n                ...constraints,\r\n            }),\r\n        });\r\n        return new LocalStream(stream, {\r\n            ...defaults,\r\n            ...constraints,\r\n        });\r\n    }\r\n    static async getDisplayMedia(constraints = {\r\n        codec: 'vp8',\r\n        resolution: 'hd',\r\n        audio: false,\r\n        video: true,\r\n        simulcast: false,\r\n    }) {\r\n        // @ts-ignore\r\n        const stream = await navigator.mediaDevices.getDisplayMedia(constraints);\r\n        return new LocalStream(stream, {\r\n            ...defaults,\r\n            ...constraints,\r\n        });\r\n    }\r\n    static computeAudioConstraints(constraints) {\r\n        return constraints.audio;\r\n    }\r\n    static computeVideoConstraints(constraints) {\r\n        if (constraints.video instanceof Object) {\r\n            return constraints.video;\r\n        }\r\n        else if (constraints.video && constraints.resolution) {\r\n            return {\r\n                ...exports.VideoConstraints[constraints.resolution].resolution,\r\n            };\r\n        }\r\n        return constraints.video;\r\n    }\r\n    getTrack(kind) {\r\n        let tracks;\r\n        if (kind === 'video') {\r\n            tracks = this.getVideoTracks();\r\n            return tracks.length > 0 ? this.getVideoTracks()[0] : undefined;\r\n        }\r\n        tracks = this.getAudioTracks();\r\n        return tracks.length > 0 ? this.getAudioTracks()[0] : undefined;\r\n    }\r\n    async getNewTrack(kind) {\r\n        const stream = await navigator.mediaDevices.getUserMedia({\r\n            [kind]: kind === 'video'\r\n                ? LocalStream.computeVideoConstraints(this.constraints)\r\n                : LocalStream.computeAudioConstraints(this.constraints),\r\n        });\r\n        return stream.getTracks()[0];\r\n    }\r\n    publishTrack(track) {\r\n        if (this.pc) {\r\n            const init = {\r\n                streams: [this],\r\n                direction: 'sendonly',\r\n            };\r\n            if (track.kind === 'video') {\r\n                if (this.encodingParams) {\r\n                    init.sendEncodings = this.encodingParams;\r\n                }\r\n                else if (this.constraints.simulcast) {\r\n                    const idx = resolutions.indexOf(this.constraints.resolution);\r\n                    const encodings = [\r\n                        {\r\n                            rid: 'f',\r\n                            maxBitrate: exports.VideoConstraints[resolutions[idx]].encodings.maxBitrate,\r\n                            maxFramerate: exports.VideoConstraints[resolutions[idx]].encodings.maxFramerate,\r\n                        },\r\n                    ];\r\n                    if (idx - 1 >= 0) {\r\n                        encodings.push({\r\n                            rid: 'h',\r\n                            scaleResolutionDownBy: 2.0,\r\n                            maxBitrate: exports.VideoConstraints[resolutions[idx - 1]].encodings.maxBitrate,\r\n                            maxFramerate: exports.VideoConstraints[resolutions[idx - 1]].encodings.maxFramerate,\r\n                        });\r\n                    }\r\n                    if (idx - 2 >= 0) {\r\n                        encodings.push({\r\n                            rid: 'q',\r\n                            scaleResolutionDownBy: 4.0,\r\n                            maxBitrate: exports.VideoConstraints[resolutions[idx - 2]].encodings.maxBitrate,\r\n                            maxFramerate: exports.VideoConstraints[resolutions[idx - 2]].encodings.maxFramerate,\r\n                        });\r\n                    }\r\n                    init.sendEncodings = encodings;\r\n                }\r\n                else {\r\n                    init.sendEncodings = [exports.VideoConstraints[this.constraints.resolution].encodings];\r\n                }\r\n            }\r\n            const transceiver = this.pc.addTransceiver(track, init);\r\n            this.setPreferredCodec(transceiver, track.kind);\r\n        }\r\n    }\r\n    setPreferredCodec(transceiver, kind) {\r\n        if ('setCodecPreferences' in transceiver) {\r\n            const cap = RTCRtpSender.getCapabilities(kind);\r\n            if (!cap)\r\n                return;\r\n            let selCodec;\r\n            if (this.constraints.preferredCodecProfile && kind === 'video') {\r\n                const allCodecProfiles = cap.codecs.filter((c) => c.mimeType.toLowerCase() === `video/${this.constraints.codec.toLowerCase()}`);\r\n                if (!allCodecProfiles) {\r\n                    return;\r\n                }\r\n                selCodec = allCodecProfiles.find((c) => { var _a; return c.sdpFmtpLine && ((_a = c.sdpFmtpLine) === null || _a === void 0 ? void 0 : _a.indexOf(`profile-level-id=${this.constraints.preferredCodecProfile}`)) >= 0; });\r\n                if (!selCodec) {\r\n                    // get first one\r\n                    selCodec = allCodecProfiles[0];\r\n                }\r\n            }\r\n            else {\r\n                selCodec = cap.codecs.find((c) => c.mimeType.toLowerCase() === `video/${this.constraints.codec.toLowerCase()}` ||\r\n                    c.mimeType.toLowerCase() === `audio/opus`);\r\n            }\r\n            if (selCodec) {\r\n                transceiver.setCodecPreferences([selCodec]);\r\n            }\r\n        }\r\n    }\r\n    updateTrack(next, prev) {\r\n        this.addTrack(next);\r\n        // If published, replace published track with track from new device\r\n        if (prev) {\r\n            this.removeTrack(prev);\r\n            prev.stop();\r\n            if (this.pc) {\r\n                this.pc.getSenders().forEach(async (sender) => {\r\n                    var _a, _b;\r\n                    if (((_a = sender === null || sender === void 0 ? void 0 : sender.track) === null || _a === void 0 ? void 0 : _a.kind) === next.kind) {\r\n                        (_b = sender.track) === null || _b === void 0 ? void 0 : _b.stop();\r\n                        sender.replaceTrack(next);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            if (this.pc) {\r\n                this.publishTrack(next);\r\n            }\r\n        }\r\n    }\r\n    initAudioEmptyTrack() {\r\n        // @ts-ignore\r\n        const AudioContext = window.AudioContext || window.webkitAudioContext;\r\n        const ctx = new AudioContext();\r\n        const oscillator = ctx.createOscillator();\r\n        oscillator.frequency.setValueAtTime(20000, ctx.currentTime);\r\n        const dst = oscillator.connect(ctx.createMediaStreamDestination());\r\n        oscillator.start();\r\n        return dst.stream.getAudioTracks()[0];\r\n    }\r\n    initVideoEmptyTrack(width, height) {\r\n        var _a;\r\n        const canvas = Object.assign(document.createElement('canvas'), { width, height });\r\n        (_a = canvas.getContext('2d')) === null || _a === void 0 ? void 0 : _a.fillRect(0, 0, width, height);\r\n        const stream = canvas.captureStream();\r\n        return stream.getVideoTracks()[0];\r\n    }\r\n    publish(transport, encodingParams) {\r\n        this.pc = transport.pc;\r\n        this.api = transport.api;\r\n        this.encodingParams = encodingParams;\r\n        this.getTracks().forEach(this.publishTrack.bind(this));\r\n    }\r\n    unpublish() {\r\n        if (this.pc) {\r\n            const tracks = this.getTracks();\r\n            this.pc.getSenders().forEach((s) => {\r\n                if (s.track && tracks.includes(s.track)) {\r\n                    this.pc.removeTrack(s);\r\n                }\r\n            });\r\n        }\r\n    }\r\n    async switchDevice(kind, deviceId) {\r\n        this.constraints = {\r\n            ...this.constraints,\r\n            [kind]: this.constraints[kind] instanceof Object\r\n                ? {\r\n                    ...this.constraints[kind],\r\n                    deviceId,\r\n                }\r\n                : { deviceId },\r\n        };\r\n        const prev = this.getTrack(kind);\r\n        // Firefox/Safari have issues when multiple input devices are used by same origin. We need to stop previous track before creating new one.\r\n        if (prev)\r\n            prev.stop();\r\n        const next = await this.getNewTrack(kind);\r\n        this.updateTrack(next, prev);\r\n    }\r\n    mute(kind) {\r\n        const track = this.getTrack(kind);\r\n        if (track && this.constraints.sendEmptyOnMute) {\r\n            const emptyTrack = kind === 'audio'\r\n                ? this.initAudioEmptyTrack()\r\n                : this.initVideoEmptyTrack((track === null || track === void 0 ? void 0 : track.getSettings().width) || 640, (track === null || track === void 0 ? void 0 : track.getSettings().height) || 360);\r\n            emptyTrack.enabled = false;\r\n            this.updateTrack(emptyTrack, track);\r\n            return;\r\n        }\r\n        if (track) {\r\n            track.stop();\r\n        }\r\n    }\r\n    async unmute(kind) {\r\n        const prev = this.getTrack(kind);\r\n        const track = await this.getNewTrack(kind);\r\n        this.updateTrack(track, prev);\r\n    }\r\n    async enableLayers(layers) {\r\n        const call = {\r\n            streamId: this.id,\r\n            layers,\r\n        };\r\n        const callStr = JSON.stringify(call);\r\n        if (this.api) {\r\n            if (this.api.readyState !== 'open') {\r\n                // queue call if we aren't open yet\r\n                this.api.onopen = () => { var _a; return (_a = this.api) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify(call)); };\r\n            }\r\n            else {\r\n                this.api.send(JSON.stringify(call));\r\n            }\r\n        }\r\n        const layerValues = ['high', 'medium', 'low'];\r\n        await Promise.all(layerValues.map(async (layer) => {\r\n            await this.updateMediaEncodingParams({ active: layers.includes(layer) }, layer);\r\n        }));\r\n    }\r\n    async updateMediaEncodingParams(encodingParams, layer) {\r\n        var _a;\r\n        if (!this.pc)\r\n            return;\r\n        const tracks = this.getTracks();\r\n        await Promise.all((_a = this.pc) === null || _a === void 0 ? void 0 : _a.getSenders().filter((sender) => sender.track && tracks.includes(sender.track)).map(async (sender) => {\r\n            const params = sender.getParameters();\r\n            if (!params.encodings) {\r\n                params.encodings = [{}];\r\n            }\r\n            let idx = 0;\r\n            if (this.constraints.simulcast && layer) {\r\n                const rid = layer === 'high' ? 'f' : layer === 'medium' ? 'h' : 'q';\r\n                idx = params.encodings.findIndex((encoding) => encoding.rid === rid);\r\n                if (params.encodings.length < idx + 1)\r\n                    return;\r\n            }\r\n            params.encodings[idx] = {\r\n                ...params.encodings[idx],\r\n                ...encodingParams,\r\n            };\r\n            await sender.setParameters(params);\r\n        }));\r\n    }\r\n}\r\nexports.LocalStream = LocalStream;\r\nfunction makeRemote(stream, transport) {\r\n    const remote = stream;\r\n    remote.audio = true;\r\n    remote.video = 'none';\r\n    remote.framerate = 'high';\r\n    remote._videoPreMute = 'high';\r\n    const select = () => {\r\n        const call = {\r\n            streamId: remote.id,\r\n            video: remote.video,\r\n            audio: remote.audio,\r\n            framerate: remote.framerate,\r\n        };\r\n        if (transport.api) {\r\n            if (transport.api.readyState !== 'open') {\r\n                // queue call if we aren't open yet\r\n                transport.api.onopen = () => { var _a; return (_a = transport.api) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify(call)); };\r\n            }\r\n            else {\r\n                transport.api.send(JSON.stringify(call));\r\n            }\r\n        }\r\n    };\r\n    remote.preferLayer = (layer) => {\r\n        remote.video = layer;\r\n        select();\r\n    };\r\n    remote.preferFramerate = (layer) => {\r\n        remote.framerate = layer;\r\n        select();\r\n    };\r\n    remote.mute = (kind) => {\r\n        if (kind === 'audio') {\r\n            remote.audio = false;\r\n        }\r\n        else if (kind === 'video') {\r\n            remote._videoPreMute = remote.video;\r\n            remote.video = 'none';\r\n        }\r\n        select();\r\n    };\r\n    remote.unmute = (kind) => {\r\n        if (kind === 'audio') {\r\n            remote.audio = true;\r\n        }\r\n        else if (kind === 'video') {\r\n            remote.video = remote._videoPreMute;\r\n        }\r\n        select();\r\n    };\r\n    return remote;\r\n}\r\nexports.makeRemote = makeRemote;\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Jb25TREsvLi9zcmMvc3RyZWFtLnRzP2U2ZGYiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGFBQWE7QUFDakMscUJBQXFCLGFBQWE7QUFDbEM7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQyxxQkFBcUIsYUFBYTtBQUNsQztBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixhQUFhO0FBQ2pDLHFCQUFxQixhQUFhO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLGNBQWM7QUFDbEMscUJBQXFCLGFBQWE7QUFDbEM7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsY0FBYztBQUNsQyxxQkFBcUIsY0FBYztBQUNuQztBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixjQUFjO0FBQ2xDLHFCQUFxQixjQUFjO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdHQUF3RyxxQ0FBcUM7QUFDN0k7QUFDQTtBQUNBO0FBQ0EseURBQXlELFFBQVEsbUhBQW1ILHVDQUF1QyxTQUFTLEVBQUU7QUFDdE87QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0ZBQXdGLHFDQUFxQztBQUM3SDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RUFBd0UsZ0JBQWdCO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsV0FBVztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsUUFBUSwyRkFBMkY7QUFDNUk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsaUNBQWlDO0FBQ25GLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsUUFBUSxnR0FBZ0c7QUFDdEo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IjAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLm1ha2VSZW1vdGUgPSBleHBvcnRzLkxvY2FsU3RyZWFtID0gZXhwb3J0cy5WaWRlb0NvbnN0cmFpbnRzID0gdm9pZCAwO1xyXG5jb25zdCByZXNvbHV0aW9ucyA9IFsncXZnYScsICd2Z2EnLCAnc2hkJywgJ2hkJywgJ2ZoZCcsICdxaGQnXTtcclxuZXhwb3J0cy5WaWRlb0NvbnN0cmFpbnRzID0ge1xyXG4gICAgcXZnYToge1xyXG4gICAgICAgIHJlc29sdXRpb246IHtcclxuICAgICAgICAgICAgd2lkdGg6IHsgaWRlYWw6IDMyMCB9LFxyXG4gICAgICAgICAgICBoZWlnaHQ6IHsgaWRlYWw6IDE4MCB9LFxyXG4gICAgICAgICAgICBmcmFtZVJhdGU6IHtcclxuICAgICAgICAgICAgICAgIGlkZWFsOiAxNSxcclxuICAgICAgICAgICAgICAgIG1heDogMzAsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbmNvZGluZ3M6IHtcclxuICAgICAgICAgICAgbWF4Qml0cmF0ZTogMTUwMDAwLFxyXG4gICAgICAgICAgICBtYXhGcmFtZXJhdGU6IDE1LjAsXHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcbiAgICB2Z2E6IHtcclxuICAgICAgICByZXNvbHV0aW9uOiB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB7IGlkZWFsOiA2NDAgfSxcclxuICAgICAgICAgICAgaGVpZ2h0OiB7IGlkZWFsOiAzNjAgfSxcclxuICAgICAgICAgICAgZnJhbWVSYXRlOiB7XHJcbiAgICAgICAgICAgICAgICBpZGVhbDogMzAsXHJcbiAgICAgICAgICAgICAgICBtYXg6IDYwLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW5jb2RpbmdzOiB7XHJcbiAgICAgICAgICAgIG1heEJpdHJhdGU6IDUwMDAwMCxcclxuICAgICAgICAgICAgbWF4RnJhbWVyYXRlOiAzMC4wLFxyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgc2hkOiB7XHJcbiAgICAgICAgcmVzb2x1dGlvbjoge1xyXG4gICAgICAgICAgICB3aWR0aDogeyBpZGVhbDogOTYwIH0sXHJcbiAgICAgICAgICAgIGhlaWdodDogeyBpZGVhbDogNTQwIH0sXHJcbiAgICAgICAgICAgIGZyYW1lUmF0ZToge1xyXG4gICAgICAgICAgICAgICAgaWRlYWw6IDMwLFxyXG4gICAgICAgICAgICAgICAgbWF4OiA2MCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVuY29kaW5nczoge1xyXG4gICAgICAgICAgICBtYXhCaXRyYXRlOiAxMjAwMDAwLFxyXG4gICAgICAgICAgICBtYXhGcmFtZXJhdGU6IDMwLjAsXHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcbiAgICBoZDoge1xyXG4gICAgICAgIHJlc29sdXRpb246IHtcclxuICAgICAgICAgICAgd2lkdGg6IHsgaWRlYWw6IDEyODAgfSxcclxuICAgICAgICAgICAgaGVpZ2h0OiB7IGlkZWFsOiA3MjAgfSxcclxuICAgICAgICAgICAgZnJhbWVSYXRlOiB7XHJcbiAgICAgICAgICAgICAgICBpZGVhbDogMzAsXHJcbiAgICAgICAgICAgICAgICBtYXg6IDYwLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW5jb2RpbmdzOiB7XHJcbiAgICAgICAgICAgIG1heEJpdHJhdGU6IDI1MDAwMDAsXHJcbiAgICAgICAgICAgIG1heEZyYW1lcmF0ZTogMzAuMCxcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxuICAgIGZoZDoge1xyXG4gICAgICAgIHJlc29sdXRpb246IHtcclxuICAgICAgICAgICAgd2lkdGg6IHsgaWRlYWw6IDE5MjAgfSxcclxuICAgICAgICAgICAgaGVpZ2h0OiB7IGlkZWFsOiAxMDgwIH0sXHJcbiAgICAgICAgICAgIGZyYW1lUmF0ZToge1xyXG4gICAgICAgICAgICAgICAgaWRlYWw6IDMwLFxyXG4gICAgICAgICAgICAgICAgbWF4OiA2MCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVuY29kaW5nczoge1xyXG4gICAgICAgICAgICBtYXhCaXRyYXRlOiA0MDAwMDAwLFxyXG4gICAgICAgICAgICBtYXhGcmFtZXJhdGU6IDMwLjAsXHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcbiAgICBxaGQ6IHtcclxuICAgICAgICByZXNvbHV0aW9uOiB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB7IGlkZWFsOiAyNTYwIH0sXHJcbiAgICAgICAgICAgIGhlaWdodDogeyBpZGVhbDogMTQ0MCB9LFxyXG4gICAgICAgICAgICBmcmFtZVJhdGU6IHtcclxuICAgICAgICAgICAgICAgIGlkZWFsOiAzMCxcclxuICAgICAgICAgICAgICAgIG1heDogNjAsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbmNvZGluZ3M6IHtcclxuICAgICAgICAgICAgbWF4Qml0cmF0ZTogODAwMDAwMCxcclxuICAgICAgICAgICAgbWF4RnJhbWVyYXRlOiAzMC4wLFxyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG59O1xyXG5jb25zdCBkZWZhdWx0cyA9IHtcclxuICAgIHJlc29sdXRpb246ICdoZCcsXHJcbiAgICBjb2RlYzogJ3ZwOCcsXHJcbiAgICBhdWRpbzogdHJ1ZSxcclxuICAgIHZpZGVvOiB0cnVlLFxyXG4gICAgc2ltdWxjYXN0OiBmYWxzZSxcclxufTtcclxuY2xhc3MgTG9jYWxTdHJlYW0gZXh0ZW5kcyBNZWRpYVN0cmVhbSB7XHJcbiAgICBjb25zdHJ1Y3RvcihzdHJlYW0sIGNvbnN0cmFpbnRzKSB7XHJcbiAgICAgICAgc3VwZXIoc3RyZWFtKTtcclxuICAgICAgICB0aGlzLmNvbnN0cmFpbnRzID0gY29uc3RyYWludHM7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgYXN5bmMgZ2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzID0gZGVmYXVsdHMpIHtcclxuICAgICAgICBjb25zdCBzdHJlYW0gPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7XHJcbiAgICAgICAgICAgIGF1ZGlvOiBMb2NhbFN0cmVhbS5jb21wdXRlQXVkaW9Db25zdHJhaW50cyh7XHJcbiAgICAgICAgICAgICAgICAuLi5kZWZhdWx0cyxcclxuICAgICAgICAgICAgICAgIC4uLmNvbnN0cmFpbnRzLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgdmlkZW86IExvY2FsU3RyZWFtLmNvbXB1dGVWaWRlb0NvbnN0cmFpbnRzKHtcclxuICAgICAgICAgICAgICAgIC4uLmRlZmF1bHRzLFxyXG4gICAgICAgICAgICAgICAgLi4uY29uc3RyYWludHMsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBuZXcgTG9jYWxTdHJlYW0oc3RyZWFtLCB7XHJcbiAgICAgICAgICAgIC4uLmRlZmF1bHRzLFxyXG4gICAgICAgICAgICAuLi5jb25zdHJhaW50cyxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBhc3luYyBnZXREaXNwbGF5TWVkaWEoY29uc3RyYWludHMgPSB7XHJcbiAgICAgICAgY29kZWM6ICd2cDgnLFxyXG4gICAgICAgIHJlc29sdXRpb246ICdoZCcsXHJcbiAgICAgICAgYXVkaW86IGZhbHNlLFxyXG4gICAgICAgIHZpZGVvOiB0cnVlLFxyXG4gICAgICAgIHNpbXVsY2FzdDogZmFsc2UsXHJcbiAgICB9KSB7XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIGNvbnN0IHN0cmVhbSA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0RGlzcGxheU1lZGlhKGNvbnN0cmFpbnRzKTtcclxuICAgICAgICByZXR1cm4gbmV3IExvY2FsU3RyZWFtKHN0cmVhbSwge1xyXG4gICAgICAgICAgICAuLi5kZWZhdWx0cyxcclxuICAgICAgICAgICAgLi4uY29uc3RyYWludHMsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgY29tcHV0ZUF1ZGlvQ29uc3RyYWludHMoY29uc3RyYWludHMpIHtcclxuICAgICAgICByZXR1cm4gY29uc3RyYWludHMuYXVkaW87XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgY29tcHV0ZVZpZGVvQ29uc3RyYWludHMoY29uc3RyYWludHMpIHtcclxuICAgICAgICBpZiAoY29uc3RyYWludHMudmlkZW8gaW5zdGFuY2VvZiBPYmplY3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbnN0cmFpbnRzLnZpZGVvO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjb25zdHJhaW50cy52aWRlbyAmJiBjb25zdHJhaW50cy5yZXNvbHV0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAuLi5leHBvcnRzLlZpZGVvQ29uc3RyYWludHNbY29uc3RyYWludHMucmVzb2x1dGlvbl0ucmVzb2x1dGlvbixcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNvbnN0cmFpbnRzLnZpZGVvO1xyXG4gICAgfVxyXG4gICAgZ2V0VHJhY2soa2luZCkge1xyXG4gICAgICAgIGxldCB0cmFja3M7XHJcbiAgICAgICAgaWYgKGtpbmQgPT09ICd2aWRlbycpIHtcclxuICAgICAgICAgICAgdHJhY2tzID0gdGhpcy5nZXRWaWRlb1RyYWNrcygpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJhY2tzLmxlbmd0aCA+IDAgPyB0aGlzLmdldFZpZGVvVHJhY2tzKClbMF0gOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyYWNrcyA9IHRoaXMuZ2V0QXVkaW9UcmFja3MoKTtcclxuICAgICAgICByZXR1cm4gdHJhY2tzLmxlbmd0aCA+IDAgPyB0aGlzLmdldEF1ZGlvVHJhY2tzKClbMF0gOiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgICBhc3luYyBnZXROZXdUcmFjayhraW5kKSB7XHJcbiAgICAgICAgY29uc3Qgc3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xyXG4gICAgICAgICAgICBba2luZF06IGtpbmQgPT09ICd2aWRlbydcclxuICAgICAgICAgICAgICAgID8gTG9jYWxTdHJlYW0uY29tcHV0ZVZpZGVvQ29uc3RyYWludHModGhpcy5jb25zdHJhaW50cylcclxuICAgICAgICAgICAgICAgIDogTG9jYWxTdHJlYW0uY29tcHV0ZUF1ZGlvQ29uc3RyYWludHModGhpcy5jb25zdHJhaW50cyksXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHN0cmVhbS5nZXRUcmFja3MoKVswXTtcclxuICAgIH1cclxuICAgIHB1Ymxpc2hUcmFjayh0cmFjaykge1xyXG4gICAgICAgIGlmICh0aGlzLnBjKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGluaXQgPSB7XHJcbiAgICAgICAgICAgICAgICBzdHJlYW1zOiBbdGhpc10sXHJcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdzZW5kb25seScsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGlmICh0cmFjay5raW5kID09PSAndmlkZW8nKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbmNvZGluZ1BhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluaXQuc2VuZEVuY29kaW5ncyA9IHRoaXMuZW5jb2RpbmdQYXJhbXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLmNvbnN0cmFpbnRzLnNpbXVsY2FzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkeCA9IHJlc29sdXRpb25zLmluZGV4T2YodGhpcy5jb25zdHJhaW50cy5yZXNvbHV0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmNvZGluZ3MgPSBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZDogJ2YnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4Qml0cmF0ZTogZXhwb3J0cy5WaWRlb0NvbnN0cmFpbnRzW3Jlc29sdXRpb25zW2lkeF1dLmVuY29kaW5ncy5tYXhCaXRyYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4RnJhbWVyYXRlOiBleHBvcnRzLlZpZGVvQ29uc3RyYWludHNbcmVzb2x1dGlvbnNbaWR4XV0uZW5jb2RpbmdzLm1heEZyYW1lcmF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpZHggLSAxID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RpbmdzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlkOiAnaCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZVJlc29sdXRpb25Eb3duQnk6IDIuMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heEJpdHJhdGU6IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tyZXNvbHV0aW9uc1tpZHggLSAxXV0uZW5jb2RpbmdzLm1heEJpdHJhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhGcmFtZXJhdGU6IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tyZXNvbHV0aW9uc1tpZHggLSAxXV0uZW5jb2RpbmdzLm1heEZyYW1lcmF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpZHggLSAyID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RpbmdzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlkOiAncScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZVJlc29sdXRpb25Eb3duQnk6IDQuMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heEJpdHJhdGU6IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tyZXNvbHV0aW9uc1tpZHggLSAyXV0uZW5jb2RpbmdzLm1heEJpdHJhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhGcmFtZXJhdGU6IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tyZXNvbHV0aW9uc1tpZHggLSAyXV0uZW5jb2RpbmdzLm1heEZyYW1lcmF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGluaXQuc2VuZEVuY29kaW5ncyA9IGVuY29kaW5ncztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGluaXQuc2VuZEVuY29kaW5ncyA9IFtleHBvcnRzLlZpZGVvQ29uc3RyYWludHNbdGhpcy5jb25zdHJhaW50cy5yZXNvbHV0aW9uXS5lbmNvZGluZ3NdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zY2VpdmVyID0gdGhpcy5wYy5hZGRUcmFuc2NlaXZlcih0cmFjaywgaW5pdCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UHJlZmVycmVkQ29kZWModHJhbnNjZWl2ZXIsIHRyYWNrLmtpbmQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHNldFByZWZlcnJlZENvZGVjKHRyYW5zY2VpdmVyLCBraW5kKSB7XHJcbiAgICAgICAgaWYgKCdzZXRDb2RlY1ByZWZlcmVuY2VzJyBpbiB0cmFuc2NlaXZlcikge1xyXG4gICAgICAgICAgICBjb25zdCBjYXAgPSBSVENSdHBTZW5kZXIuZ2V0Q2FwYWJpbGl0aWVzKGtpbmQpO1xyXG4gICAgICAgICAgICBpZiAoIWNhcClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgbGV0IHNlbENvZGVjO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb25zdHJhaW50cy5wcmVmZXJyZWRDb2RlY1Byb2ZpbGUgJiYga2luZCA9PT0gJ3ZpZGVvJykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYWxsQ29kZWNQcm9maWxlcyA9IGNhcC5jb2RlY3MuZmlsdGVyKChjKSA9PiBjLm1pbWVUeXBlLnRvTG93ZXJDYXNlKCkgPT09IGB2aWRlby8ke3RoaXMuY29uc3RyYWludHMuY29kZWMudG9Mb3dlckNhc2UoKX1gKTtcclxuICAgICAgICAgICAgICAgIGlmICghYWxsQ29kZWNQcm9maWxlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNlbENvZGVjID0gYWxsQ29kZWNQcm9maWxlcy5maW5kKChjKSA9PiB7IHZhciBfYTsgcmV0dXJuIGMuc2RwRm10cExpbmUgJiYgKChfYSA9IGMuc2RwRm10cExpbmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmRleE9mKGBwcm9maWxlLWxldmVsLWlkPSR7dGhpcy5jb25zdHJhaW50cy5wcmVmZXJyZWRDb2RlY1Byb2ZpbGV9YCkpID49IDA7IH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFzZWxDb2RlYykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCBmaXJzdCBvbmVcclxuICAgICAgICAgICAgICAgICAgICBzZWxDb2RlYyA9IGFsbENvZGVjUHJvZmlsZXNbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzZWxDb2RlYyA9IGNhcC5jb2RlY3MuZmluZCgoYykgPT4gYy5taW1lVHlwZS50b0xvd2VyQ2FzZSgpID09PSBgdmlkZW8vJHt0aGlzLmNvbnN0cmFpbnRzLmNvZGVjLnRvTG93ZXJDYXNlKCl9YCB8fFxyXG4gICAgICAgICAgICAgICAgICAgIGMubWltZVR5cGUudG9Mb3dlckNhc2UoKSA9PT0gYGF1ZGlvL29wdXNgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoc2VsQ29kZWMpIHtcclxuICAgICAgICAgICAgICAgIHRyYW5zY2VpdmVyLnNldENvZGVjUHJlZmVyZW5jZXMoW3NlbENvZGVjXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB1cGRhdGVUcmFjayhuZXh0LCBwcmV2KSB7XHJcbiAgICAgICAgdGhpcy5hZGRUcmFjayhuZXh0KTtcclxuICAgICAgICAvLyBJZiBwdWJsaXNoZWQsIHJlcGxhY2UgcHVibGlzaGVkIHRyYWNrIHdpdGggdHJhY2sgZnJvbSBuZXcgZGV2aWNlXHJcbiAgICAgICAgaWYgKHByZXYpIHtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVUcmFjayhwcmV2KTtcclxuICAgICAgICAgICAgcHJldi5zdG9wKCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBjKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBjLmdldFNlbmRlcnMoKS5mb3JFYWNoKGFzeW5jIChzZW5kZXIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgX2EsIF9iO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgoKF9hID0gc2VuZGVyID09PSBudWxsIHx8IHNlbmRlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VuZGVyLnRyYWNrKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eua2luZCkgPT09IG5leHQua2luZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAoX2IgPSBzZW5kZXIudHJhY2spID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zdG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRlci5yZXBsYWNlVHJhY2sobmV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBjKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnB1Ymxpc2hUcmFjayhuZXh0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGluaXRBdWRpb0VtcHR5VHJhY2soKSB7XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIGNvbnN0IEF1ZGlvQ29udGV4dCA9IHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dDtcclxuICAgICAgICBjb25zdCBjdHggPSBuZXcgQXVkaW9Db250ZXh0KCk7XHJcbiAgICAgICAgY29uc3Qgb3NjaWxsYXRvciA9IGN0eC5jcmVhdGVPc2NpbGxhdG9yKCk7XHJcbiAgICAgICAgb3NjaWxsYXRvci5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoMjAwMDAsIGN0eC5jdXJyZW50VGltZSk7XHJcbiAgICAgICAgY29uc3QgZHN0ID0gb3NjaWxsYXRvci5jb25uZWN0KGN0eC5jcmVhdGVNZWRpYVN0cmVhbURlc3RpbmF0aW9uKCkpO1xyXG4gICAgICAgIG9zY2lsbGF0b3Iuc3RhcnQoKTtcclxuICAgICAgICByZXR1cm4gZHN0LnN0cmVhbS5nZXRBdWRpb1RyYWNrcygpWzBdO1xyXG4gICAgfVxyXG4gICAgaW5pdFZpZGVvRW1wdHlUcmFjayh3aWR0aCwgaGVpZ2h0KSB7XHJcbiAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgIGNvbnN0IGNhbnZhcyA9IE9iamVjdC5hc3NpZ24oZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyksIHsgd2lkdGgsIGhlaWdodCB9KTtcclxuICAgICAgICAoX2EgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xyXG4gICAgICAgIGNvbnN0IHN0cmVhbSA9IGNhbnZhcy5jYXB0dXJlU3RyZWFtKCk7XHJcbiAgICAgICAgcmV0dXJuIHN0cmVhbS5nZXRWaWRlb1RyYWNrcygpWzBdO1xyXG4gICAgfVxyXG4gICAgcHVibGlzaCh0cmFuc3BvcnQsIGVuY29kaW5nUGFyYW1zKSB7XHJcbiAgICAgICAgdGhpcy5wYyA9IHRyYW5zcG9ydC5wYztcclxuICAgICAgICB0aGlzLmFwaSA9IHRyYW5zcG9ydC5hcGk7XHJcbiAgICAgICAgdGhpcy5lbmNvZGluZ1BhcmFtcyA9IGVuY29kaW5nUGFyYW1zO1xyXG4gICAgICAgIHRoaXMuZ2V0VHJhY2tzKCkuZm9yRWFjaCh0aGlzLnB1Ymxpc2hUcmFjay5iaW5kKHRoaXMpKTtcclxuICAgIH1cclxuICAgIHVucHVibGlzaCgpIHtcclxuICAgICAgICBpZiAodGhpcy5wYykge1xyXG4gICAgICAgICAgICBjb25zdCB0cmFja3MgPSB0aGlzLmdldFRyYWNrcygpO1xyXG4gICAgICAgICAgICB0aGlzLnBjLmdldFNlbmRlcnMoKS5mb3JFYWNoKChzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocy50cmFjayAmJiB0cmFja3MuaW5jbHVkZXMocy50cmFjaykpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBjLnJlbW92ZVRyYWNrKHMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBhc3luYyBzd2l0Y2hEZXZpY2Uoa2luZCwgZGV2aWNlSWQpIHtcclxuICAgICAgICB0aGlzLmNvbnN0cmFpbnRzID0ge1xyXG4gICAgICAgICAgICAuLi50aGlzLmNvbnN0cmFpbnRzLFxyXG4gICAgICAgICAgICBba2luZF06IHRoaXMuY29uc3RyYWludHNba2luZF0gaW5zdGFuY2VvZiBPYmplY3RcclxuICAgICAgICAgICAgICAgID8ge1xyXG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMuY29uc3RyYWludHNba2luZF0sXHJcbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlSWQsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICA6IHsgZGV2aWNlSWQgfSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IHByZXYgPSB0aGlzLmdldFRyYWNrKGtpbmQpO1xyXG4gICAgICAgIC8vIEZpcmVmb3gvU2FmYXJpIGhhdmUgaXNzdWVzIHdoZW4gbXVsdGlwbGUgaW5wdXQgZGV2aWNlcyBhcmUgdXNlZCBieSBzYW1lIG9yaWdpbi4gV2UgbmVlZCB0byBzdG9wIHByZXZpb3VzIHRyYWNrIGJlZm9yZSBjcmVhdGluZyBuZXcgb25lLlxyXG4gICAgICAgIGlmIChwcmV2KVxyXG4gICAgICAgICAgICBwcmV2LnN0b3AoKTtcclxuICAgICAgICBjb25zdCBuZXh0ID0gYXdhaXQgdGhpcy5nZXROZXdUcmFjayhraW5kKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVRyYWNrKG5leHQsIHByZXYpO1xyXG4gICAgfVxyXG4gICAgbXV0ZShraW5kKSB7XHJcbiAgICAgICAgY29uc3QgdHJhY2sgPSB0aGlzLmdldFRyYWNrKGtpbmQpO1xyXG4gICAgICAgIGlmICh0cmFjayAmJiB0aGlzLmNvbnN0cmFpbnRzLnNlbmRFbXB0eU9uTXV0ZSkge1xyXG4gICAgICAgICAgICBjb25zdCBlbXB0eVRyYWNrID0ga2luZCA9PT0gJ2F1ZGlvJ1xyXG4gICAgICAgICAgICAgICAgPyB0aGlzLmluaXRBdWRpb0VtcHR5VHJhY2soKVxyXG4gICAgICAgICAgICAgICAgOiB0aGlzLmluaXRWaWRlb0VtcHR5VHJhY2soKHRyYWNrID09PSBudWxsIHx8IHRyYWNrID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0cmFjay5nZXRTZXR0aW5ncygpLndpZHRoKSB8fCA2NDAsICh0cmFjayA9PT0gbnVsbCB8fCB0cmFjayA9PT0gdm9pZCAwID8gdm9pZCAwIDogdHJhY2suZ2V0U2V0dGluZ3MoKS5oZWlnaHQpIHx8IDM2MCk7XHJcbiAgICAgICAgICAgIGVtcHR5VHJhY2suZW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVRyYWNrKGVtcHR5VHJhY2ssIHRyYWNrKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHJhY2spIHtcclxuICAgICAgICAgICAgdHJhY2suc3RvcCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFzeW5jIHVubXV0ZShraW5kKSB7XHJcbiAgICAgICAgY29uc3QgcHJldiA9IHRoaXMuZ2V0VHJhY2soa2luZCk7XHJcbiAgICAgICAgY29uc3QgdHJhY2sgPSBhd2FpdCB0aGlzLmdldE5ld1RyYWNrKGtpbmQpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlVHJhY2sodHJhY2ssIHByZXYpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZW5hYmxlTGF5ZXJzKGxheWVycykge1xyXG4gICAgICAgIGNvbnN0IGNhbGwgPSB7XHJcbiAgICAgICAgICAgIHN0cmVhbUlkOiB0aGlzLmlkLFxyXG4gICAgICAgICAgICBsYXllcnMsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBjYWxsU3RyID0gSlNPTi5zdHJpbmdpZnkoY2FsbCk7XHJcbiAgICAgICAgaWYgKHRoaXMuYXBpKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFwaS5yZWFkeVN0YXRlICE9PSAnb3BlbicpIHtcclxuICAgICAgICAgICAgICAgIC8vIHF1ZXVlIGNhbGwgaWYgd2UgYXJlbid0IG9wZW4geWV0XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwaS5vbm9wZW4gPSAoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuYXBpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2VuZChKU09OLnN0cmluZ2lmeShjYWxsKSk7IH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwaS5zZW5kKEpTT04uc3RyaW5naWZ5KGNhbGwpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBsYXllclZhbHVlcyA9IFsnaGlnaCcsICdtZWRpdW0nLCAnbG93J107XHJcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwobGF5ZXJWYWx1ZXMubWFwKGFzeW5jIChsYXllcikgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZU1lZGlhRW5jb2RpbmdQYXJhbXMoeyBhY3RpdmU6IGxheWVycy5pbmNsdWRlcyhsYXllcikgfSwgbGF5ZXIpO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH1cclxuICAgIGFzeW5jIHVwZGF0ZU1lZGlhRW5jb2RpbmdQYXJhbXMoZW5jb2RpbmdQYXJhbXMsIGxheWVyKSB7XHJcbiAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgIGlmICghdGhpcy5wYylcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIGNvbnN0IHRyYWNrcyA9IHRoaXMuZ2V0VHJhY2tzKCk7XHJcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoKF9hID0gdGhpcy5wYykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldFNlbmRlcnMoKS5maWx0ZXIoKHNlbmRlcikgPT4gc2VuZGVyLnRyYWNrICYmIHRyYWNrcy5pbmNsdWRlcyhzZW5kZXIudHJhY2spKS5tYXAoYXN5bmMgKHNlbmRlcikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwYXJhbXMgPSBzZW5kZXIuZ2V0UGFyYW1ldGVycygpO1xyXG4gICAgICAgICAgICBpZiAoIXBhcmFtcy5lbmNvZGluZ3MpIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtcy5lbmNvZGluZ3MgPSBbe31dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBpZHggPSAwO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb25zdHJhaW50cy5zaW11bGNhc3QgJiYgbGF5ZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJpZCA9IGxheWVyID09PSAnaGlnaCcgPyAnZicgOiBsYXllciA9PT0gJ21lZGl1bScgPyAnaCcgOiAncSc7XHJcbiAgICAgICAgICAgICAgICBpZHggPSBwYXJhbXMuZW5jb2RpbmdzLmZpbmRJbmRleCgoZW5jb2RpbmcpID0+IGVuY29kaW5nLnJpZCA9PT0gcmlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChwYXJhbXMuZW5jb2RpbmdzLmxlbmd0aCA8IGlkeCArIDEpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHBhcmFtcy5lbmNvZGluZ3NbaWR4XSA9IHtcclxuICAgICAgICAgICAgICAgIC4uLnBhcmFtcy5lbmNvZGluZ3NbaWR4XSxcclxuICAgICAgICAgICAgICAgIC4uLmVuY29kaW5nUGFyYW1zLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBhd2FpdCBzZW5kZXIuc2V0UGFyYW1ldGVycyhwYXJhbXMpO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLkxvY2FsU3RyZWFtID0gTG9jYWxTdHJlYW07XHJcbmZ1bmN0aW9uIG1ha2VSZW1vdGUoc3RyZWFtLCB0cmFuc3BvcnQpIHtcclxuICAgIGNvbnN0IHJlbW90ZSA9IHN0cmVhbTtcclxuICAgIHJlbW90ZS5hdWRpbyA9IHRydWU7XHJcbiAgICByZW1vdGUudmlkZW8gPSAnbm9uZSc7XHJcbiAgICByZW1vdGUuZnJhbWVyYXRlID0gJ2hpZ2gnO1xyXG4gICAgcmVtb3RlLl92aWRlb1ByZU11dGUgPSAnaGlnaCc7XHJcbiAgICBjb25zdCBzZWxlY3QgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2FsbCA9IHtcclxuICAgICAgICAgICAgc3RyZWFtSWQ6IHJlbW90ZS5pZCxcclxuICAgICAgICAgICAgdmlkZW86IHJlbW90ZS52aWRlbyxcclxuICAgICAgICAgICAgYXVkaW86IHJlbW90ZS5hdWRpbyxcclxuICAgICAgICAgICAgZnJhbWVyYXRlOiByZW1vdGUuZnJhbWVyYXRlLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRyYW5zcG9ydC5hcGkpIHtcclxuICAgICAgICAgICAgaWYgKHRyYW5zcG9ydC5hcGkucmVhZHlTdGF0ZSAhPT0gJ29wZW4nKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBxdWV1ZSBjYWxsIGlmIHdlIGFyZW4ndCBvcGVuIHlldFxyXG4gICAgICAgICAgICAgICAgdHJhbnNwb3J0LmFwaS5vbm9wZW4gPSAoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRyYW5zcG9ydC5hcGkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZW5kKEpTT04uc3RyaW5naWZ5KGNhbGwpKTsgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRyYW5zcG9ydC5hcGkuc2VuZChKU09OLnN0cmluZ2lmeShjYWxsKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmVtb3RlLnByZWZlckxheWVyID0gKGxheWVyKSA9PiB7XHJcbiAgICAgICAgcmVtb3RlLnZpZGVvID0gbGF5ZXI7XHJcbiAgICAgICAgc2VsZWN0KCk7XHJcbiAgICB9O1xyXG4gICAgcmVtb3RlLnByZWZlckZyYW1lcmF0ZSA9IChsYXllcikgPT4ge1xyXG4gICAgICAgIHJlbW90ZS5mcmFtZXJhdGUgPSBsYXllcjtcclxuICAgICAgICBzZWxlY3QoKTtcclxuICAgIH07XHJcbiAgICByZW1vdGUubXV0ZSA9IChraW5kKSA9PiB7XHJcbiAgICAgICAgaWYgKGtpbmQgPT09ICdhdWRpbycpIHtcclxuICAgICAgICAgICAgcmVtb3RlLmF1ZGlvID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGtpbmQgPT09ICd2aWRlbycpIHtcclxuICAgICAgICAgICAgcmVtb3RlLl92aWRlb1ByZU11dGUgPSByZW1vdGUudmlkZW87XHJcbiAgICAgICAgICAgIHJlbW90ZS52aWRlbyA9ICdub25lJztcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZWN0KCk7XHJcbiAgICB9O1xyXG4gICAgcmVtb3RlLnVubXV0ZSA9IChraW5kKSA9PiB7XHJcbiAgICAgICAgaWYgKGtpbmQgPT09ICdhdWRpbycpIHtcclxuICAgICAgICAgICAgcmVtb3RlLmF1ZGlvID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoa2luZCA9PT0gJ3ZpZGVvJykge1xyXG4gICAgICAgICAgICByZW1vdGUudmlkZW8gPSByZW1vdGUuX3ZpZGVvUHJlTXV0ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZWN0KCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHJlbW90ZTtcclxufVxyXG5leHBvcnRzLm1ha2VSZW1vdGUgPSBtYWtlUmVtb3RlO1xyXG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0\n")},function(module,exports,__webpack_require__){"use strict";eval('\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nexports.LocalStream = exports.Client = void 0;\r\nconst client_1 = __webpack_require__(2);\r\nexports.Client = client_1.default;\r\nconst stream_1 = __webpack_require__(0);\r\nObject.defineProperty(exports, "LocalStream", { enumerable: true, get: function () { return stream_1.LocalStream; } });\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Jb25TREsvLi9zcmMvaW5kZXgudHM/NzFiZCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0EsaUJBQWlCLG1CQUFPLENBQUMsQ0FBVTtBQUNuQztBQUNBLGlCQUFpQixtQkFBTyxDQUFDLENBQVU7QUFDbkMsK0NBQStDLHFDQUFxQyw2QkFBNkIsRUFBRSxFQUFFIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLkxvY2FsU3RyZWFtID0gZXhwb3J0cy5DbGllbnQgPSB2b2lkIDA7XHJcbmNvbnN0IGNsaWVudF8xID0gcmVxdWlyZShcIi4vY2xpZW50XCIpO1xyXG5leHBvcnRzLkNsaWVudCA9IGNsaWVudF8xLmRlZmF1bHQ7XHJcbmNvbnN0IHN0cmVhbV8xID0gcmVxdWlyZShcIi4vc3RyZWFtXCIpO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJMb2NhbFN0cmVhbVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc3RyZWFtXzEuTG9jYWxTdHJlYW07IH0gfSk7XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1\n')},function(module,exports,__webpack_require__){"use strict";eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Transport = void 0;\r\nconst stream_1 = __webpack_require__(0);\r\nconst API_CHANNEL = 'ion-sfu';\r\nconst ERR_NO_SESSION = 'no active session, join first';\r\nvar Role;\r\n(function (Role) {\r\n    Role[Role[\"pub\"] = 0] = \"pub\";\r\n    Role[Role[\"sub\"] = 1] = \"sub\";\r\n})(Role || (Role = {}));\r\nclass Transport {\r\n    constructor(role, signal, config) {\r\n        this.signal = signal;\r\n        this.pc = new RTCPeerConnection(config);\r\n        this.candidates = [];\r\n        if (role === Role.pub) {\r\n            this.pc.createDataChannel(API_CHANNEL);\r\n        }\r\n        this.pc.onicecandidate = ({ candidate }) => {\r\n            if (candidate) {\r\n                this.signal.trickle({ target: role, candidate });\r\n            }\r\n        };\r\n        this.pc.oniceconnectionstatechange = async (e) => {\r\n            // iOS iceConnectionState can go straight to \"failed\" without emitting \"disconnected\"\r\n            if (this.pc.iceConnectionState === 'disconnected' || this.pc.iceConnectionState === 'failed') {\r\n                if (this.pc.restartIce !== undefined) {\r\n                    // this will trigger onNegotiationNeeded\r\n                    this.pc.restartIce();\r\n                }\r\n            }\r\n        };\r\n    }\r\n}\r\nexports.Transport = Transport;\r\nclass Client {\r\n    constructor(signal, config = {\r\n        codec: 'vp8',\r\n        iceServers: [\r\n            {\r\n                urls: ['stun:stun.l.google.com:19302', 'stun:stun1.l.google.com:19302'],\r\n            },\r\n        ],\r\n    }) {\r\n        this.signal = signal;\r\n        this.config = config;\r\n        signal.onnegotiate = this.negotiate.bind(this);\r\n        signal.ontrickle = this.trickle.bind(this);\r\n    }\r\n    async join(sid, uid) {\r\n        this.transports = {\r\n            [Role.pub]: new Transport(Role.pub, this.signal, this.config),\r\n            [Role.sub]: new Transport(Role.sub, this.signal, this.config),\r\n        };\r\n        this.transports[Role.sub].pc.ontrack = (ev) => {\r\n            const stream = ev.streams[0];\r\n            const remote = stream_1.makeRemote(stream, this.transports[Role.sub]);\r\n            if (this.ontrack) {\r\n                this.ontrack(ev.track, remote);\r\n            }\r\n        };\r\n        const apiReady = new Promise((resolve) => {\r\n            this.transports[Role.sub].pc.ondatachannel = (ev) => {\r\n                if (ev.channel.label === API_CHANNEL) {\r\n                    this.transports[Role.sub].api = ev.channel;\r\n                    this.transports[Role.pub].api = ev.channel;\r\n                    ev.channel.onmessage = (e) => {\r\n                        try {\r\n                            const msg = JSON.parse(e.data);\r\n                            this.processChannelMessage(msg);\r\n                        }\r\n                        catch (err) {\r\n                            /* tslint:disable-next-line:no-console */\r\n                            console.error(err);\r\n                        }\r\n                    };\r\n                    resolve();\r\n                    return;\r\n                }\r\n                if (this.ondatachannel) {\r\n                    this.ondatachannel(ev);\r\n                }\r\n            };\r\n        });\r\n        const offer = await this.transports[Role.pub].pc.createOffer();\r\n        await this.transports[Role.pub].pc.setLocalDescription(offer);\r\n        const answer = await this.signal.join(sid, uid, offer);\r\n        await this.transports[Role.pub].pc.setRemoteDescription(answer);\r\n        this.transports[Role.pub].candidates.forEach((c) => this.transports[Role.pub].pc.addIceCandidate(c));\r\n        this.transports[Role.pub].pc.onnegotiationneeded = this.onNegotiationNeeded.bind(this);\r\n        return apiReady;\r\n    }\r\n    leave() {\r\n        if (this.transports) {\r\n            Object.values(this.transports).forEach((t) => t.pc.close());\r\n            delete this.transports;\r\n        }\r\n    }\r\n    getPubStats(selector) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        return this.transports[Role.pub].pc.getStats(selector);\r\n    }\r\n    getSubStats(selector) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        return this.transports[Role.sub].pc.getStats(selector);\r\n    }\r\n    publish(stream, encodingParams) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        stream.publish(this.transports[Role.pub], encodingParams);\r\n    }\r\n    restartIce() {\r\n        this.renegotiate(true);\r\n    }\r\n    createDataChannel(label) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        return this.transports[Role.pub].pc.createDataChannel(label);\r\n    }\r\n    close() {\r\n        if (this.transports) {\r\n            Object.values(this.transports).forEach((t) => t.pc.close());\r\n        }\r\n        this.signal.close();\r\n    }\r\n    trickle({ candidate, target }) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        if (this.transports[target].pc.remoteDescription) {\r\n            this.transports[target].pc.addIceCandidate(candidate);\r\n        }\r\n        else {\r\n            this.transports[target].candidates.push(candidate);\r\n        }\r\n    }\r\n    async negotiate(description) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        let answer;\r\n        try {\r\n            await this.transports[Role.sub].pc.setRemoteDescription(description);\r\n            this.transports[Role.sub].candidates.forEach((c) => this.transports[Role.sub].pc.addIceCandidate(c));\r\n            this.transports[Role.sub].candidates = [];\r\n            answer = await this.transports[Role.sub].pc.createAnswer();\r\n            await this.transports[Role.sub].pc.setLocalDescription(answer);\r\n            this.signal.answer(answer);\r\n        }\r\n        catch (err) {\r\n            /* tslint:disable-next-line:no-console */\r\n            console.error(err);\r\n            if (this.onerrnegotiate)\r\n                this.onerrnegotiate(Role.sub, err, description, answer);\r\n        }\r\n    }\r\n    onNegotiationNeeded() {\r\n        this.renegotiate(false);\r\n    }\r\n    async renegotiate(iceRestart) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        let offer;\r\n        let answer;\r\n        try {\r\n            offer = await this.transports[Role.pub].pc.createOffer({ iceRestart });\r\n            await this.transports[Role.pub].pc.setLocalDescription(offer);\r\n            answer = await this.signal.offer(offer);\r\n            await this.transports[Role.pub].pc.setRemoteDescription(answer);\r\n        }\r\n        catch (err) {\r\n            /* tslint:disable-next-line:no-console */\r\n            console.error(err);\r\n            if (this.onerrnegotiate)\r\n                this.onerrnegotiate(Role.pub, err, offer, answer);\r\n        }\r\n    }\r\n    processChannelMessage(msg) {\r\n        if (msg.method !== undefined && msg.params !== undefined) {\r\n            switch (msg.method) {\r\n                case 'audioLevels':\r\n                    if (this.onspeaker) {\r\n                        this.onspeaker(msg.params);\r\n                    }\r\n                    break;\r\n                case 'activeLayer':\r\n                    if (this.onactivelayer) {\r\n                        this.onactivelayer(msg.params);\r\n                    }\r\n                    break;\r\n                default:\r\n                // do nothing\r\n            }\r\n        }\r\n        else {\r\n            // legacy channel message - payload contains audio levels\r\n            if (this.onspeaker) {\r\n                this.onspeaker(msg);\r\n            }\r\n        }\r\n    }\r\n}\r\nexports.default = Client;\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Jb25TREsvLi9zcmMvY2xpZW50LnRzP2U3MWIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBLGlCQUFpQixtQkFBTyxDQUFDLENBQVU7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxvQkFBb0I7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxZQUFZO0FBQy9DO0FBQ0EscUNBQXFDLDBCQUEwQjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxvQkFBb0I7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvRUFBb0UsYUFBYTtBQUNqRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiIyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5UcmFuc3BvcnQgPSB2b2lkIDA7XHJcbmNvbnN0IHN0cmVhbV8xID0gcmVxdWlyZShcIi4vc3RyZWFtXCIpO1xyXG5jb25zdCBBUElfQ0hBTk5FTCA9ICdpb24tc2Z1JztcclxuY29uc3QgRVJSX05PX1NFU1NJT04gPSAnbm8gYWN0aXZlIHNlc3Npb24sIGpvaW4gZmlyc3QnO1xyXG52YXIgUm9sZTtcclxuKGZ1bmN0aW9uIChSb2xlKSB7XHJcbiAgICBSb2xlW1JvbGVbXCJwdWJcIl0gPSAwXSA9IFwicHViXCI7XHJcbiAgICBSb2xlW1JvbGVbXCJzdWJcIl0gPSAxXSA9IFwic3ViXCI7XHJcbn0pKFJvbGUgfHwgKFJvbGUgPSB7fSkpO1xyXG5jbGFzcyBUcmFuc3BvcnQge1xyXG4gICAgY29uc3RydWN0b3Iocm9sZSwgc2lnbmFsLCBjb25maWcpIHtcclxuICAgICAgICB0aGlzLnNpZ25hbCA9IHNpZ25hbDtcclxuICAgICAgICB0aGlzLnBjID0gbmV3IFJUQ1BlZXJDb25uZWN0aW9uKGNvbmZpZyk7XHJcbiAgICAgICAgdGhpcy5jYW5kaWRhdGVzID0gW107XHJcbiAgICAgICAgaWYgKHJvbGUgPT09IFJvbGUucHViKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGMuY3JlYXRlRGF0YUNoYW5uZWwoQVBJX0NIQU5ORUwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnBjLm9uaWNlY2FuZGlkYXRlID0gKHsgY2FuZGlkYXRlIH0pID0+IHtcclxuICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaWduYWwudHJpY2tsZSh7IHRhcmdldDogcm9sZSwgY2FuZGlkYXRlIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnBjLm9uaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlID0gYXN5bmMgKGUpID0+IHtcclxuICAgICAgICAgICAgLy8gaU9TIGljZUNvbm5lY3Rpb25TdGF0ZSBjYW4gZ28gc3RyYWlnaHQgdG8gXCJmYWlsZWRcIiB3aXRob3V0IGVtaXR0aW5nIFwiZGlzY29ubmVjdGVkXCJcclxuICAgICAgICAgICAgaWYgKHRoaXMucGMuaWNlQ29ubmVjdGlvblN0YXRlID09PSAnZGlzY29ubmVjdGVkJyB8fCB0aGlzLnBjLmljZUNvbm5lY3Rpb25TdGF0ZSA9PT0gJ2ZhaWxlZCcpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBjLnJlc3RhcnRJY2UgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgd2lsbCB0cmlnZ2VyIG9uTmVnb3RpYXRpb25OZWVkZWRcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBjLnJlc3RhcnRJY2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5UcmFuc3BvcnQgPSBUcmFuc3BvcnQ7XHJcbmNsYXNzIENsaWVudCB7XHJcbiAgICBjb25zdHJ1Y3RvcihzaWduYWwsIGNvbmZpZyA9IHtcclxuICAgICAgICBjb2RlYzogJ3ZwOCcsXHJcbiAgICAgICAgaWNlU2VydmVyczogW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB1cmxzOiBbJ3N0dW46c3R1bi5sLmdvb2dsZS5jb206MTkzMDInLCAnc3R1bjpzdHVuMS5sLmdvb2dsZS5jb206MTkzMDInXSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICBdLFxyXG4gICAgfSkge1xyXG4gICAgICAgIHRoaXMuc2lnbmFsID0gc2lnbmFsO1xyXG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xyXG4gICAgICAgIHNpZ25hbC5vbm5lZ290aWF0ZSA9IHRoaXMubmVnb3RpYXRlLmJpbmQodGhpcyk7XHJcbiAgICAgICAgc2lnbmFsLm9udHJpY2tsZSA9IHRoaXMudHJpY2tsZS5iaW5kKHRoaXMpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgam9pbihzaWQsIHVpZCkge1xyXG4gICAgICAgIHRoaXMudHJhbnNwb3J0cyA9IHtcclxuICAgICAgICAgICAgW1JvbGUucHViXTogbmV3IFRyYW5zcG9ydChSb2xlLnB1YiwgdGhpcy5zaWduYWwsIHRoaXMuY29uZmlnKSxcclxuICAgICAgICAgICAgW1JvbGUuc3ViXTogbmV3IFRyYW5zcG9ydChSb2xlLnN1YiwgdGhpcy5zaWduYWwsIHRoaXMuY29uZmlnKSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0ucGMub250cmFjayA9IChldikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzdHJlYW0gPSBldi5zdHJlYW1zWzBdO1xyXG4gICAgICAgICAgICBjb25zdCByZW1vdGUgPSBzdHJlYW1fMS5tYWtlUmVtb3RlKHN0cmVhbSwgdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9udHJhY2spIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub250cmFjayhldi50cmFjaywgcmVtb3RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgYXBpUmVhZHkgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLnBjLm9uZGF0YWNoYW5uZWwgPSAoZXYpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChldi5jaGFubmVsLmxhYmVsID09PSBBUElfQ0hBTk5FTCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0uYXBpID0gZXYuY2hhbm5lbDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLmFwaSA9IGV2LmNoYW5uZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgZXYuY2hhbm5lbC5vbm1lc3NhZ2UgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbXNnID0gSlNPTi5wYXJzZShlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzQ2hhbm5lbE1lc3NhZ2UobXNnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tY29uc29sZSAqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub25kYXRhY2hhbm5lbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25kYXRhY2hhbm5lbChldik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3Qgb2ZmZXIgPSBhd2FpdCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLmNyZWF0ZU9mZmVyKCk7XHJcbiAgICAgICAgYXdhaXQgdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYy5zZXRMb2NhbERlc2NyaXB0aW9uKG9mZmVyKTtcclxuICAgICAgICBjb25zdCBhbnN3ZXIgPSBhd2FpdCB0aGlzLnNpZ25hbC5qb2luKHNpZCwgdWlkLCBvZmZlcik7XHJcbiAgICAgICAgYXdhaXQgdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYy5zZXRSZW1vdGVEZXNjcmlwdGlvbihhbnN3ZXIpO1xyXG4gICAgICAgIHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0uY2FuZGlkYXRlcy5mb3JFYWNoKChjKSA9PiB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLmFkZEljZUNhbmRpZGF0ZShjKSk7XHJcbiAgICAgICAgdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYy5vbm5lZ290aWF0aW9ubmVlZGVkID0gdGhpcy5vbk5lZ290aWF0aW9uTmVlZGVkLmJpbmQodGhpcyk7XHJcbiAgICAgICAgcmV0dXJuIGFwaVJlYWR5O1xyXG4gICAgfVxyXG4gICAgbGVhdmUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMudHJhbnNwb3J0cykge1xyXG4gICAgICAgICAgICBPYmplY3QudmFsdWVzKHRoaXMudHJhbnNwb3J0cykuZm9yRWFjaCgodCkgPT4gdC5wYy5jbG9zZSgpKTtcclxuICAgICAgICAgICAgZGVsZXRlIHRoaXMudHJhbnNwb3J0cztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXRQdWJTdGF0cyhzZWxlY3Rvcikge1xyXG4gICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKEVSUl9OT19TRVNTSU9OKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuZ2V0U3RhdHMoc2VsZWN0b3IpO1xyXG4gICAgfVxyXG4gICAgZ2V0U3ViU3RhdHMoc2VsZWN0b3IpIHtcclxuICAgICAgICBpZiAoIXRoaXMudHJhbnNwb3J0cykge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihFUlJfTk9fU0VTU0lPTik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLnBjLmdldFN0YXRzKHNlbGVjdG9yKTtcclxuICAgIH1cclxuICAgIHB1Ymxpc2goc3RyZWFtLCBlbmNvZGluZ1BhcmFtcykge1xyXG4gICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKEVSUl9OT19TRVNTSU9OKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3RyZWFtLnB1Ymxpc2godGhpcy50cmFuc3BvcnRzW1JvbGUucHViXSwgZW5jb2RpbmdQYXJhbXMpO1xyXG4gICAgfVxyXG4gICAgcmVzdGFydEljZSgpIHtcclxuICAgICAgICB0aGlzLnJlbmVnb3RpYXRlKHRydWUpO1xyXG4gICAgfVxyXG4gICAgY3JlYXRlRGF0YUNoYW5uZWwobGFiZWwpIHtcclxuICAgICAgICBpZiAoIXRoaXMudHJhbnNwb3J0cykge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihFUlJfTk9fU0VTU0lPTik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLmNyZWF0ZURhdGFDaGFubmVsKGxhYmVsKTtcclxuICAgIH1cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnRyYW5zcG9ydHMpIHtcclxuICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnRyYW5zcG9ydHMpLmZvckVhY2goKHQpID0+IHQucGMuY2xvc2UoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2lnbmFsLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgICB0cmlja2xlKHsgY2FuZGlkYXRlLCB0YXJnZXQgfSkge1xyXG4gICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKEVSUl9OT19TRVNTSU9OKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMudHJhbnNwb3J0c1t0YXJnZXRdLnBjLnJlbW90ZURlc2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0c1t0YXJnZXRdLnBjLmFkZEljZUNhbmRpZGF0ZShjYW5kaWRhdGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50cmFuc3BvcnRzW3RhcmdldF0uY2FuZGlkYXRlcy5wdXNoKGNhbmRpZGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgYXN5bmMgbmVnb3RpYXRlKGRlc2NyaXB0aW9uKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnRyYW5zcG9ydHMpIHtcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoRVJSX05PX1NFU1NJT04pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgYW5zd2VyO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0ucGMuc2V0UmVtb3RlRGVzY3JpcHRpb24oZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLmNhbmRpZGF0ZXMuZm9yRWFjaCgoYykgPT4gdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXS5wYy5hZGRJY2VDYW5kaWRhdGUoYykpO1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLmNhbmRpZGF0ZXMgPSBbXTtcclxuICAgICAgICAgICAgYW5zd2VyID0gYXdhaXQgdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXS5wYy5jcmVhdGVBbnN3ZXIoKTtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXS5wYy5zZXRMb2NhbERlc2NyaXB0aW9uKGFuc3dlcik7XHJcbiAgICAgICAgICAgIHRoaXMuc2lnbmFsLmFuc3dlcihhbnN3ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIC8qIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1jb25zb2xlICovXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMub25lcnJuZWdvdGlhdGUpXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uZXJybmVnb3RpYXRlKFJvbGUuc3ViLCBlcnIsIGRlc2NyaXB0aW9uLCBhbnN3ZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIG9uTmVnb3RpYXRpb25OZWVkZWQoKSB7XHJcbiAgICAgICAgdGhpcy5yZW5lZ290aWF0ZShmYWxzZSk7XHJcbiAgICB9XHJcbiAgICBhc3luYyByZW5lZ290aWF0ZShpY2VSZXN0YXJ0KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnRyYW5zcG9ydHMpIHtcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoRVJSX05PX1NFU1NJT04pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgb2ZmZXI7XHJcbiAgICAgICAgbGV0IGFuc3dlcjtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBvZmZlciA9IGF3YWl0IHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuY3JlYXRlT2ZmZXIoeyBpY2VSZXN0YXJ0IH0pO1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLnNldExvY2FsRGVzY3JpcHRpb24ob2ZmZXIpO1xyXG4gICAgICAgICAgICBhbnN3ZXIgPSBhd2FpdCB0aGlzLnNpZ25hbC5vZmZlcihvZmZlcik7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuc2V0UmVtb3RlRGVzY3JpcHRpb24oYW5zd2VyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICAvKiB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tY29uc29sZSAqL1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9uZXJybmVnb3RpYXRlKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5vbmVycm5lZ290aWF0ZShSb2xlLnB1YiwgZXJyLCBvZmZlciwgYW5zd2VyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcm9jZXNzQ2hhbm5lbE1lc3NhZ2UobXNnKSB7XHJcbiAgICAgICAgaWYgKG1zZy5tZXRob2QgIT09IHVuZGVmaW5lZCAmJiBtc2cucGFyYW1zICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChtc2cubWV0aG9kKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdhdWRpb0xldmVscyc6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub25zcGVha2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25zcGVha2VyKG1zZy5wYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2FjdGl2ZUxheWVyJzpcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vbmFjdGl2ZWxheWVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25hY3RpdmVsYXllcihtc2cucGFyYW1zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgLy8gZG8gbm90aGluZ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBsZWdhY3kgY2hhbm5lbCBtZXNzYWdlIC0gcGF5bG9hZCBjb250YWlucyBhdWRpbyBsZXZlbHNcclxuICAgICAgICAgICAgaWYgKHRoaXMub25zcGVha2VyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uc3BlYWtlcihtc2cpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuZGVmYXVsdCA9IENsaWVudDtcclxuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///2\n")}]);